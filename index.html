<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ² - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800;900&family=Tajawal:wght@200;300;400;500;700;800;900&display=swap" rel="stylesheet">
<style>
/* Ù„Ø§ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ */
</style>
</head>
<body>
<div class="container">
    <header class="header">
        <div class="header-content">
            <div class="university-info">
                <div>
                    <h1>Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²</h1>
                    <div class="tagline">Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒÙŠ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…</div>
                </div>
            </div>
            <div class="logo-container" onclick="document.getElementById('logoInput').click()">
                <div class="logo">
                    <!-- âœ… Ø´Ø¹Ø§Ø± ÙˆÙ‡Ù…ÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠ -->
                    <img id="logoImage" class="logo-image" src="png-clipart-king-abdulaziz-university-dar-al-hekma-university-king-saud-university-education-saudi-gazette-label-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ø§Ù…Ø¹Ø©" style="display:block;">
                    <div class="logo-placeholder" id="logoPlaceholder" style="display:none;">
                        <i class="fas fa-university"></i>
                        <span>Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø´Ø¹Ø§Ø±</span>
                    </div>
                </div>
                <input type="file" id="logoInput" class="logo-input" accept="image/*">
            </div>
        </div>
    </header>

    <div class="chat-container">
        <div class="chat-messages" id="chatMessages">
            <div class="welcome-screen" id="welcomeScreen">
                <div class="welcome-card">
                    <div class="welcome-logo">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <h2 class="welcome-title">Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ! ğŸ“</h2>
                    <p class="welcome-subtitle">
                        Ø£Ù†Ø§ Ù…Ø³Ø§Ø¹Ø¯Ùƒ Ø§Ù„Ø°ÙƒÙŠ ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯ Ø§Ù„Ø¹Ø²ÙŠØ². Ø£Ø³ØªØ®Ø¯Ù… Ø£Ø­Ø¯Ø« ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ø£Ù‚Ø¯Ù… Ù„Ùƒ Ø£ÙØ¶Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ø³ØªÙØ³Ø§Ø±Ø§ØªÙƒ.
                    </p>
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <div class="typing-bubble">
                    <span class="typing-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø«...</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="input-area">
            <div class="quick-actions">
                <button class="quick-action" data-message="Ù…Ø§ Ù‡ÙŠ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²ØŸ">ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button>
                <button class="quick-action" data-message="Ù…ØªÙ‰ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²ØŸ">ğŸ“… Ù…ÙˆØ§Ø¹ÙŠØ¯ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</button>
                <button class="quick-action" data-message="Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ§Ø­Ø© ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²ØŸ">ğŸ“ Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠØ©</button>
                <button class="quick-action" data-message="ÙƒÙŠÙ Ø£ØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ© ÙÙŠ Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ²ØŸ">ğŸ“š Ø§Ù„Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø±Ù‚Ù…ÙŠØ©</button>
            </div>
            <div class="input-container">
                <input type="text" class="message-input" id="messageInput" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§...">
                <button class="send-button" id="sendButton"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
</div>

<script>
/* âš™ï¸ Ù†ÙØ³ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù…Ø¹ ØªØµØ­ÙŠØ­ ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ */
let messages = [];
let isFirstMessage = true;
let conversationHistory = [];

const API_CONFIG = {
    baseURL: 'https://api.perplexity.ai',
    endpoint: '/chat/completions',
    apiKey: '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',
    model: 'sonar-pro',
    maxTokens: 1000,
    temperature: 0.7
};

const SYSTEM_PROMPT = "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø°ÙƒÙŠ Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø¹Ø¨Ø¯Ø§Ù„Ø¹Ø²ÙŠØ². Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¨ÙˆØ¶ÙˆØ­ ÙˆØ§Ø­ØªØ±Ø§ÙÙŠØ©.";

const chatMessages = document.getElementById('chatMessages');
const messageInput = document.getElementById('messageInput');
const sendButton = document.getElementById('sendButton');
const typingIndicator = document.getElementById('typingIndicator');
const welcomeScreen = document.getElementById('welcomeScreen');
const quickActions = document.querySelectorAll('.quick-action');
const logoInput = document.getElementById('logoInput');
const logoImage = document.getElementById('logoImage');
const logoPlaceholder = document.getElementById('logoPlaceholder');

/* âœ… Ø¥ØµÙ„Ø§Ø­: Ø¬Ø¹Ù„ Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ ÙŠØ¹Ù…Ù„ ÙØ¹Ù„Ø§Ù‹ */
sendButton.addEventListener('click', () => sendMessage());
messageInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
});
quickActions.forEach(btn => btn.addEventListener('click', () => sendMessage(btn.dataset.message)));

logoInput.addEventListener('change', e => {
    const file = e.target.files[0];
    if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = ev => {
            logoImage.src = ev.target.result;
            logoImage.style.display = 'block';
            logoPlaceholder.style.display = 'none';
        };
        reader.readAsDataURL(file);
    }
});

async function sendMessage(preMsg = null) {
    const msg = preMsg || messageInput.value.trim();
    if (!msg) return;

    if (isFirstMessage) {
        welcomeScreen.style.display = 'none';
        isFirstMessage = false;
    }

    addMessage(msg, 'user');
    messageInput.value = '';
    sendButton.disabled = true;

    showTypingIndicator();
    try {
        const res = await getAIResponse(msg);
        hideTypingIndicator();
        addMessage(res, 'bot');
    } catch {
        hideTypingIndicator();
        addMessage("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø·Ù„Ø¨Ùƒ.", 'bot');
    } finally {
        sendButton.disabled = false;
        messageInput.disabled = false;
    }
}

function addMessage(content, type) {
    const el = document.createElement('div');
    el.className = `message ${type}`;
    el.innerHTML = `
        <div class="message-content">
            <div class="avatar">${type === 'user' ? '<i class="fas fa-user"></i>' : '<i class="fas fa-robot"></i>'}</div>
            <div><div class="message-bubble">${content}</div></div>
        </div>`;
    chatMessages.insertBefore(el, typingIndicator);
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

async function getAIResponse(userMessage) {
    conversationHistory.push({ role: 'user', content: userMessage });
    const response = await fetch(`${API_CONFIG.baseURL}${API_CONFIG.endpoint}`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${API_CONFIG.apiKey}`,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            model: API_CONFIG.model,
            messages: [{ role: 'system', content: SYSTEM_PROMPT }, ...conversationHistory],
            max_tokens: API_CONFIG.maxTokens,
            temperature: API_CONFIG.temperature
        })
    });
    const data = await response.json();
    const aiText = data.choices?.[0]?.message?.content || "Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø©.";
    conversationHistory.push({ role: 'assistant', content: aiText });
    return aiText;
}

function showTypingIndicator() { typingIndicator.style.display = 'flex'; chatMessages.scrollTop = chatMessages.scrollHeight; }
function hideTypingIndicator() { typingIndicator.style.display = 'none'; }
</script>
</body>
</html>
